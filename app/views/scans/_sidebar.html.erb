<%
   revisions     = @scan_sidebar[:revisions]
   revision_data = @scan_sidebar[:data]

   total_revision_count   = @scan.revisions.size
   current_revision_count = revisions.count
%>

<%= render 'shared/sidebar_scan' %>

<% if total_revision_count > 0 %>
    <hr/>

    <div id="sidebar-revisions">
        <ul class="nav nav-pills nav-stacked flex-column">
            <li class="nav-item nav-header">
                <a class="nav-link">
                    Revisions

                    <% if total_revision_count != current_revision_count %>
                        &mdash;
                        Showing <%= current_revision_count %> out of
                        <%= total_revision_count %>
                    <% end %>
                </a>
            </li>

            <%
               revisions.each do |revision|
                   active = (@revision && @revision.id == revision.id)

                   max_severity   = revision_data[revision.id] ?
                           revision_data[revision.id][:max_severity] : nil

                   entry_count    = revision_data[revision.id] ?
                           revision_data[revision.id][:entry_count] : 0

                   if entry_count == 0
                       max_severity = 'none'
                   end
            %>

                <li class="nav-item" id="sidebar-revisions-id-<%= revision.id %>"

                    <% if entry_count > 0 %>
                        title="<%= pluralize entry_count, 'new entry' %> with a maximum severity of <%= max_severity %>."
                    <% else %>
                        title="<%= pluralize entry_count, 'new entry' %>."
                    <% end %>
                >

                    <%= link_to_with_filters revision, class: "nav-link #{('active' if active)}" do %>
                        #<%= revision.index %>

                        <span>
                            &ndash;
                            <%= pluralize revision.sitemap_entries.size, 'page' %>

                            <% if (reviewed_entries = revision.reviewed_entries.size) > 0 %>
                                , <%= reviewed_entries %> reviewed
                                <%= 'entry'.pluralize reviewed_entries %>
                            <% end %>
                        </span>

                        <span>
                            <span class="badge rounded-pill badge-severity-<%= max_severity %>">
                                <%= entry_count %>
                            </span>
                        </span>
                    <% end %>
                </li>

                <li class="nav-item sidebar-info"
                    id="sidebar-revisions-id-<%= revision.id %>-info">
                    <small class="nav-link text-muted">
                        <%= render partial: '/shared/revision_info',
                                   locals: {
                                           scan:               @scan,
                                           revision:           revision,
                                           hide_revision_name: true,
                                           extended: true
                                   } %>
                    </small>
                </li>
            <% end %>
        </ul>
    </div>
<% end %>
