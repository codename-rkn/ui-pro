<div class="page-header">
    <h1>
        <span class="text-muted fs-4">
            <% if @entry.input_vector.affected_input_name %>
                <%= @entry.input_vector %> input
                <code><%= @entry.input_vector.affected_input_name %></code>
            <% end %>

            at
            <%= link_to_url_with_external(
                    external: @entry.referring_page.dom.url,
                    internal: site_path(
                        @site,
                        sitemap_entry_url( entry.referring_page.sitemap_entry )
                    ),
                    display_path_only: true
                )
            %>
            pointing to
            <%= link_to_url_with_external(
                    external: @entry.input_vector.action,
                    internal: site_path(
                        @site,
                        sitemap_entry_url( entry.input_vector.sitemap_entry )
                    ),
                    display_path_only: true
                )
            %>
        </span>
    </h1>

  <h3>
    <span class="text-muted fs-5">
      with sinks
      <span class="pull-left badge label-severity-none">
        <%= @entry.sinks.map(&:name).join( ", " ) %>
      </span>

      and platforms
      <span class="pull-left badge label-severity-none">
        <%= @entry.platforms.map(&:name).join( ", " ) %>
      </span>
    </span>
  </h3>

</div>

<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="notes-tab" data-bs-toggle="tab" data-bs-target="#notes" type="button" role="tab" aria-controls="notes" aria-selected="true">Notes</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="edit-notes-tab" data-bs-toggle="tab" data-bs-target="#edit-notes" type="button" role="tab" aria-controls="edit-notes" aria-selected="false">Edit</button>
  </li>
</ul>
<div class="tab-content" id="myTabContent">
  <div class="tab-pane fade show active" id="notes" role="tabpanel" aria-labelledby="notes-tab">
    <% if !@entry.note.text.blank? %>
      <%= md @entry.note.text %>
    <% else %>
      <p class="well">
        No notes attached to this entry.
      </p>
    <% end %>

    <% if @entry.note.attachments.any? %>
      <ul>
        <% @entry.note.attachments.each do |attachment| %>
          <li>
            <%= link_to attachment do %>
              <%= attachment.name %>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% end %>
  </div>
  <div class="tab-pane fade" id="edit-notes" role="tabpanel" aria-labelledby="edit-notes-tab">
    <%= simple_form_for [@entry.site, @entry.scan, @entry.revision, @entry], remote: true do |form| %>
        <%= form.simple_fields_for :note do |f| %>
          <div class="form-group">
            <%= f.text_area :text, class: 'form-control', placeholder: 'You can use Markdown for your notes.' %>
          </div>
          <div class="form-group">
            <ul>
              <% @entry.note.attachments.each do |attachment| %>
                <li>
                  <%= link_to attachment, remote: true, method: :delete, data: { "turbo-method": :delete } do %>
                    <i class="fa fa-trash-can"></i>
                  <% end %>

                  <%= link_to attachment do %>
                    <%= attachment.name %>
                  <% end %>
                </li>
              <% end %>
            </ul>
          </div>

          <div class="form-group">
            <%= f.input :attachment, as: 'file', class: 'form-control' %>
          </div>
        <% end %>

      <div class="form-group">
        <%= form.button :submit, value: 'Save' %>
      </div>
    <% end %>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
  </div>
</div>

<hr/>

<div id="sink-description" class="alert alert-primary">
  <%= sink_to_description( entry.sinks.first.name ).html_safe %>
</div>

<div class="mt-3" id="input_vector">
    <h2>
        <a class="anchor" href="#!/input_vector">
            <span class="fa fa-link"></span>
        </a>

        Input vector
    </h2>
    <%= render 'entries/input_vector', entry: entry %>
</div>

<hr/>

<div class="mt-3" id="reproduction">
    <h2>
        <a class="anchor" href="#!/reproduction">
            <span class="fa fa-link"></span>
        </a>

        Reproduction
    </h2>

    <%= render 'entries/reproduction', entry: entry %>
</div>

<hr/>

<% if @entry.has_proofs? && @entry.page && !@entry.page.response.to_s.empty? %>
<div class="mt-3" id="identification">
    <h2>
        <a class="anchor" href="#!/identification">
            <span class="fa fa-link"></span>
        </a>

        Identification
    </h2>

    <%= render 'entries/identification', entry: entry %>
</div>

<hr/>
<% end %>

<div class="mt-3" id="advanced">
    <h2>
        <a class="anchor" href="#!/advanced">
            <span class="fa fa-link"></span>
        </a>

        Advanced information
    </h2>

    <p class="text-muted">
        The following sections provide all available data regarding the
        state of the web application and associated traffic.
    </p>

    <%= render 'entries/advanced', entry: entry %>
</div>
