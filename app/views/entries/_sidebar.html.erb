<%
   sections = {
        input_vector: 'Input vector',
        reproduction: 'Reproduction'
   }

   if @entry.has_proofs? && @entry.page && (!@entry.page.response.to_s.empty? ||
     @entry&.page&.dom&.execution_flow_sinks&.any?)
       sections.merge!(
           identification: 'Identification'
       )
   end

   sections.merge!(
       _:        nil,
       advanced: 'Advanced info'
   )

   if @entry.page
     sections.merge!(
       advanced_affected_page: '&ndash; Affected page'
     )

     if !@entry.page.request.to_s.empty? || !@entry.page.response.to_s.empty?
         sections.merge!(
             advanced_affected_page_http: '&mdash; HTTP traffic',
         )
     end

     if @entry.page.dom
       if (!@entry.page.dom.body.to_s.empty? || !@entry.page.response.body.to_s.empty?) &&
            (@entry.page.dom.body != @entry.page.response.body) &&
               @entry.page.dom.transitions.any?

           sections.merge!(
               advanced_affected_page_dom_processing: '&mdash; DOM processing',
           )
       end

       if @entry.page.dom.execution_flow_sinks.any?
           sections.merge!(
               advanced_affected_page_execution_flow: '&mdash; Execution-flow',
           )
       end

       if @entry.page.dom.data_flow_sinks.any?
           sections.merge!(
               advanced_affected_page_data_flow: '&mdash; Data-flow',
           )
       end
     end
   end

   if @entry.referring_page
     sections.merge!(
         advanced_referring_page: '&ndash; Referring page',
     )

     if !@entry.referring_page.request.to_s.empty? ||
             !@entry.referring_page.response.to_s.empty?

         sections.merge!(
             advanced_referring_page_http: '&mdash; HTTP traffic',
         )
     end

     if @entry.referring_page.dom
       if (!@entry.referring_page.dom.body.to_s.empty? || !@entry.referring_page.response.body.to_s.empty?) &&
               (@entry.referring_page.dom.body != @entry.referring_page.response.body) &&
               @entry.referring_page.dom.transitions.any?

           sections.merge!(
               advanced_referring_page_dom_processing: '&mdash; DOM processing',
           )
       end

       if @entry.referring_page.dom.execution_flow_sinks.any?
           sections.merge!(
               advanced_referring_page_execution_flow: '&mdash; Execution-flow',
           )
       end
     end

     if @entry.referring_page.dom.data_flow_sinks.any?
         sections.merge!(
             advanced_referring_page_data_flow: '&mdash; Data-flow',
         )
     end
   end
%>

<%= render partial: 'shared/sidebar_scan', locals: { hide_site_buttons: true } %>

<hr/>

<% if @entry.reviewed_by_revision? %>
    <div id="reviewed-by-revision">
        <span class="label label-info label-emphasis">
            Reviewed by
            <%= link_to @entry.reviewed_by_revision,
                        reviews_site_scan_revision_path(
                                @entry.reviewed_by_revision.site,
                                @entry.reviewed_by_revision.scan,
                                @entry.reviewed_by_revision
                        ) %>

            <% if @entry.reviewed_by_revision.scan != @scan %>
                of
                <%= link_to @entry.reviewed_by_revision.scan.name,
                            site_scan_path(
                                    @entry.reviewed_by_revision.site,
                                    @entry.reviewed_by_revision.scan
                            ) %>
            <% end %>
            as:
        </span>
    </div>
<% end %>

<%= render 'form' %>


<% if @entry.siblings.count > 1 %>
    <%= render 'entries/siblings' %>
<% end %>

<hr/>

<div id="scrollspy-container">
    <div>
        <ul class="nav nav-pills nav-stacked flex-column">
            <li class="nav-item">
                <a href="#top" class="nav-link scroll">
                    <i class="fa fa-chevron-up"></i>
                    Top
                </a>
            </li>
            <% sections.each do |id, title| %>
                <li class="nav-item">
                <% if id == :_ %>
                    <hr/>
                <% else %>
                    <a href="#<%= id.to_s %>" class="nav-link scroll">
                        <%= title.to_s.html_safe %>
                    </a>
                <% end %>
                </li>
            <% end %>
        </ul>
    </div>
</div>
