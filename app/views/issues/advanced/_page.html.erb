<% if !page.request.to_s.empty? || !page.response.to_s.empty? %>

    <h4>
        <a id="<%= id %>_http" class="anchor"
           href="<%= id_to_location "#{id}_http" %>">
            <span class="fa fa-link"></span>
        </a>

        HTTP traffic
    </h4>

    <div class="row">
        <% if !page.request.to_s.empty? %>
            <div class="col-md-6">
                <h5>
                    <a id="<%= id %>_http_request" class="anchor"
                       href="<%= id_to_location "#{id}_http_request" %>">
                        <span class="fa fa-link"></span>
                    </a>

                    Request
                </h5>

                <pre class="highlight-container code-container"><%= highlight_http_request( page.request.to_s, issue, issue.vector.seed ) %></pre>
            </div>
        <% end %>

        <% if !page.response.to_s.empty? %>
            <div class="col-md-6">
                <h5>
                    <a id="<%= id %>_http_response" class="anchor"
                       href="<%= id_to_location "#{id}_http_response" %>">
                        <span class="fa fa-link"></span>
                    </a>

                    Response <small>&mdash; Binary bodies will not be displayed.</small>
                </h5>

                <pre class="highlight-container code-container"><%= highlight_proof( page.response.to_s, issue.proof ).html_safe %></pre>
            </div>
        <% end %>
    </div>
<% end %>

<% if page.dom.transitions.any? %>

    <div class="row">
        <div class="col-md-12">
            <h4>
                <a id="<%= id %>_dom_processing" class="anchor"
                   href="<%= id_to_location "#{id}_dom_processing" %>">
                    <span class="fa fa-link"></span>
                </a>

                DOM processing
            </h4>

            <h5>
                <a id="<%= id %>_transitions" class="anchor"
                   href="<%= id_to_location "#{id}_transitions" %>">
                    <span class="fa fa-link"></span>
                </a>

                Transitions
            </h5>

            <p class="text-muted">
                Transitions describe the steps required to restore the state
                of the page to the one it had when it was processed by the
                scanner.
                <br/>
                In essence, each transition represents an interaction with
                the interface of the web application.
            </p>

            <%= render 'issues/advanced/page/transitions',
                       page: page,
                       id: "#{id}_dom_processing",
                       debug: true %>

            <% if (!page.dom.body.empty? || !page.response.body.empty?) &&
                (page.dom.body != page.response.body) %>

                <%= render 'issues/advanced/page/body',
                           page: page,
                           id: "#{id}_dom_processing" %>
            </div>
        </div>
    <% end %>
<% end %>

<% if page.dom.execution_flow_sinks.any? %>
    <div class="row">
        <div class="col-md-12">
            <h4>
                <a id="<%= id %>_execution_flow" class="anchor"
                   href="<%= id_to_location "#{id}_execution_flow" %>">
                    <span class="fa fa-link"></span>
                </a>

                Execution-flow sinks
            </h4>

            <p class="text-muted">
                Execution-flow sinks log the successful execution of an injected
                JavaScript payload within the page's environment.
                <br/>
                Each sink is a point of payload execution.
            </p>

            <%= render 'issues/advanced/page/sink/execution_flow',
                       page: page,
                       id: id %>
        </div>
    </div>
<% end %>

<% if page.dom.data_flow_sinks.any? %>
    <div class="row">
        <div class="col-md-12">
            <h4>
                <a id="<%= id %>_data_flow" class="anchor"
                   href="<%= id_to_location "#{id}_data_flow" %>">
                    <span class="fa fa-link"></span>
                </a>

                Data-flow sinks
            </h4>

            <p class="text-muted">
                Data-flow sinks track the flow of the injected taint through
                key points in the JavaScript environment of the page.
                <br/>
                Each sink is a function which was passed tainted arguments.
            </p>

            <%= render 'issues/advanced/page/sink/data_flow',
                       page: page,
                       id: id %>
        </div>
    </div>
<% end %>
