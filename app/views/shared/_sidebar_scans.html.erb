<%
   heading    = local_assigns[:title] || 'Associated scans'
   scans      = local_assigns[:scans] || []
   with_site  = local_assigns[:with_site]

   scan_details_options = local_assigns[:scan_details_options] || {}
%>

    <ul id="sidebar-scans" class="nav nav-pills nav-stacked flex-column">
        <li class="nav-item nav-header">
            <a class="nav-link">
                <%= heading %>

                <span class="badge rounded-pill bg-secondary">
                    <%= scans.count %>
                </span>
            </a>
        </li>

        <%
           if scans.any?

           scans.each do |scan|
               entry_count    = scan.entries.size
               revision_count = scan.revisions.size
        %>

            <li class="nav-item" id="sidebar-scans-id-<%= scan.id %>"

                <% if revision_count > 0 %>
                    title="<%= pluralize entry_count, 'entry' %>."
                <% else %>
                    title="Has not run yet."
                <% end %>
            >
                <%= link_to_with_filters scan, class: 'nav-link' do %>
                    <%= scan.name %>

                    <% if with_site %>
                        for <%= scan.site.url %>
                    <% end %>

                    <% if revision_count > 0 %>
                        <span class="badge rounded-pill badge-severity-<%= max_severity %>">
                            <%= entry_count %>
                        </span>
                    <% end %>
                <% end %>
            </li>

            <li class="nav-item sidebar-info" id="sidebar-scans-id-<%= scan.id %>-info">
                <small class="text-muted">
                    <%= render partial: '/shared/scan_info',
                               locals: { scan: scan } %>

                    <% if lr = scan.last_revision %>
                        <%= render partial: '/shared/revision_info', locals: {
                                revision:       lr,
                                hide_scan_name: true
                        } %>
                    <% end %>
                </small>
            </li>
        <% end %>
    </ul>
<% end %>
