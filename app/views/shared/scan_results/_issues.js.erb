<% if data[:issues].count > 1 %>
  function updateChart() {
    const chart = new window.Charts.issueChart('chart-issues');

    chart.initializeChart();

    const data = {
      labels: <%= data[:chart_data][:issue_names].keys.to_json.html_safe %>,
      issueNames: <%= data[:chart_data][:issue_names].values.to_json.html_safe %>,
      severityIndexForIssue: <%= data[:chart_data][:severity_index_for_issue].values.to_json.html_safe %>
    };

    chart.updateDataset(data);
  };
<% end %>

<% if site.scanned? %>
  <% if data[:issues].any? %>
      if ($("#summary-charts-issues-container").length) {
        $("#sidebar").html("<%= j render(partial: sidebar_partial_path, formats: :html) %>");
        $("#scan-info-container").html("<%= j render(partial: "shared/scan_heading", formats: :html) %>");
        $("#summary-sitemap").html("<%= j render(partial: 'shared/scan_results/issues/sitemap', formats: :html, locals: { data: data }) %>");
        $("#issues-filter-container").html("<%= j render(partial: 'shared/scan_results/issues/filter', formats: :html, locals: { data: data }) %>");
        $("#summary-statistics").replaceWith("<%= j render(partial: 'shared/scan_results/issues/statistics', formats: :html, locals: { data: data }) %>");
        $("#summary-issues").html("<%= j render(partial: 'shared/scan_results/issues/list', formats: :html, locals: { id: 'summary', data: data }) %>");
        updateChart();
      } else {
        <%= render(partial: 'shared/scan_results', formats: :js, locals: { sidebar_partial_path: sidebar_partial_path }) %>
      }
  <% else %>
    <%= render(partial: 'shared/scan_results', formats: :js, locals: { sidebar_partial_path: sidebar_partial_path }) %>
  <% end %>
<% else %>
  <%= render(partial: 'shared/scan_results', formats: :js, locals: { sidebar_partial_path: sidebar_partial_path }) %>
<% end %>
