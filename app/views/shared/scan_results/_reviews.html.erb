<%
   by_state = {}
   entries   = @reviews[:entries]

   group_entries = proc do |group, entry|
       state = entry.auto_review_status

       group[state] ||= []
       group[state] << entry
   end

   if entries.is_a? Array
       entries.each do |entry|
           group_entries.call by_state, entry
       end
   else
       scoped_find_each( entries ) do |entry|
           group_entries.call by_state, entry
       end
   end

   {
           'regression'     => 'regressions',
           'fixed'          => 'fixed',
           'false_positive' => 'false_positives'
   }.each do |k, v|
       next if !by_state.include?( k )
       by_state[v] = by_state.delete(k)
   end
%>

<p class="text-muted">
    The listed entries have been automatically reviewed based on state changes
    over time and across scans.
</p>

<%
   hr = nil
   by_state.each do |state, entry_group| %>
    <%= '<hr/>'.html_safe if hr %>
    <% hr = true %>

    <div id="reviews-<%= state %>">
        <h2>
            <%= state.humanize %>

            <span class="badge bg-info">
                <%= entry_group.size %>
            </span>
        </h2>

        <p class="text text-muted">
            <%=
                case state
                    when 'fixed'
                        <<-EOHTML
                            These entries did not appear in subsequent scans.
                        EOHTML

                    when 'regressions'
                        <<-EOHTML
                            These entries were marked as fixed but re-appeared.
                        EOHTML

                    when 'false_positives'
                        <<-EOHTML
                            These entries were marked as false-positives, as a result
                            their state was applied to other identical entries.
                        EOHTML
                end
            %>
        </p>

        <%= render partial: 'shared/scan_results/entries/list', locals: {
                data: {
                        entries: entry_group
                },
                id:                        "reviews-#{state}",
                show_reviewed_by_revision: true,
                force_show_logged_by:      true,
                hide_state_icon:           false
        } %>
    </div>
<% end %>
