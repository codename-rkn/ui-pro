<%
   sections = {}
   ScanResults::SCAN_RESULT_ACTIONS.each do |section|
       section = section.to_s
       sections[section] = params[:action].to_s == section
   end

   params_h = params.permit.to_h
%>

<div class="col-md-12">
    <ul class="nav nav-tabs">

        <% if @revision %>
            <li id="live-tab" class="nav-item">
                <%= link_to params_h.merge( action: 'summary' ).merge(filter_params), class: "nav-link #{'active' if sections['summary']}" do %>
                    Summary
                <% end %>
            </li>
        <% end %>

        <li id="entries-tab" class="nav-item">
            <%= link_to params_h.merge( action: 'entries' ).merge(filter_params), class: "nav-link #{('active' if sections['entries'])}" do %>
                Entries
            <% end %>
        </li>

        <li id="coverage-tab" class="nav-item">
            <%= link_to params_h.merge( action: 'coverage' ).merge(filter_params), class: "nav-link #{'active' if sections['coverage']}" do %>
                Coverage
            <% end %>
        </li>

        <% if @reviews_count > 0 %>
            <li id="reviews-tab" class="nav-item">
                <%= link_to params_h.merge( action: 'reviews' ).merge(filter_params), class: "nav-link #{'active' if sections['reviews']}" do %>
                    Reviews

                    <span class="badge">
                        <%= @reviews_count %>
                    </span>
                <% end %>
            </li>
        <% end %>

        <% if @revision %>
            <li id="health-tab" class="nav-item">
                <%= link_to params_h.merge( action: 'health' ).merge(filter_params), class: "nav-link #{'active' if sections['health']}" do %>
                    Health
                <% end %>
            </li>

            <% if !@revision.error_messages.blank? %>
                <li id="errors-tab" class="nav-item">
                    <%= link_to params_h.merge( action: 'errors' ).merge(filter_params), class: "nav-link #{'active' if sections['errors']}" do %>
                        Errors
                    <% end %>
                </li>
            <% end %>
        <% end %>

        <% if @revision %>
            <li id="configuration-tab" class="nav-item">
                <%= link_to params_h.merge( action: 'configuration' ).merge(filter_params), class: "nav-link #{'active' if sections['configuration']}" do %>
                    Configuration
                <% end %>
            </li>
        <% end %>

      <li id="events-tab" class="nav-item">
        <%= link_to params_h.merge( action: 'events' ).merge(filter_params), class: "nav-link #{'active' if sections['events']}" do %>
            Events
        <% end %>
      </li>

        <% if @revision&.report %>
            <li id="export-tab" class="nav-item">
                <%= link_to params_h.merge( action: 'export' ).merge(filter_params), class: "nav-link #{'active' if sections['export']}" do %>
                    Export
                <% end %>
            </li>
        <% end %>
    </ul>

    <div class="tab-content">
        <% if sections['summary'] %>
            <div class="tab-pane <%= 'active' if sections['summary'] %>" id="summary">
                <%= render partial: 'shared/scan_results/summary', locals: {
                    data: @summary
                }, formats: :html %>
            </div>
        <% end %>

        <% if sections['entries'] %>
            <div class="tab-pane <%= 'active' if sections['entries'] %>" id="entries">
                <%= render partial: 'shared/scan_results/entries', locals: {
                    data: @entries_summary
                }, formats: :html %>
            </div>
        <% end %>

        <% if sections['coverage'] %>
            <div class="tab-pane <%= 'active' if sections['coverage'] %>" id="coverage">
                <%= render partial: 'shared/scan_results/coverage', formats: :html %>
            </div>
        <% end %>

        <% if @reviews_count > 0 && sections['reviews'] %>
            <div class="tab-pane <%= 'active' if sections['reviews'] %>" id="reviews">
                <%= render partial: 'shared/scan_results/reviews', formats: :html %>
            </div>
        <% end %>

        <% if sections['health'] %>
            <div class="tab-pane <%= 'active' if sections['health'] %>" id="health">
                <%= render partial: 'shared/scan_results/health', formats: :html %>
            </div>
        <% end %>

        <% if sections['errors'] %>
            <div class="tab-pane <%= 'active' if sections['errors'] %>" id="errors">
                <%= render partial: 'shared/scan_results/errors', formats: :html %>
            </div>
        <% end %>

        <% if sections['configuration'] %>
            <div class="tab-pane <%= 'active' if sections['configuration'] %>" id="configuration">
                <%= render partial: 'shared/scan_results/configuration', formats: :html %>
            </div>
        <% end %>

      <% if sections['events'] %>
          <div class="tab-pane <%= 'active' if sections['events'] %>" id="events">
            <%= render partial: 'shared/scan_results/events', formats: :html %>
          </div>
      <% end %>

        <% if sections['export'] %>
            <div class="tab-pane <%= 'active' if sections['export'] %>" id="export">
                <%= render partial: 'shared/scan_results/export', formats: :html %>
            </div>
        <% end %>
    </div>
</div>
