<%
   scans     = @site_sidebar[:scans]
   scan_data = @site_sidebar[:data]

   total_scan_count   = @site.scans.count
   current_scan_count = scans.count
%>

<% if scans.any? %>
<ul id="sidebar-scans" class="nav nav-pills nav-stacked flex-column">
    <li class="nav-header nav-item">
        <a class="nav-link">
            Scans

            <% if total_scan_count != current_scan_count %>
                &mdash;
                Showing <%= current_scan_count %> out of
                <%= total_scan_count %>
            <% end %>
        </a>
    </li>

    <%
       scans.each do |scan|
            next if !scan.id

            max_severity   = scan_data[scan.id] ?
                    scan_data[scan.id][:max_severity] : nil

            entry_count    = scan_data[scan.id] ?
                    scan_data[scan.id][:entry_count] : 0

            revision_count = scan.revisions.size

            if revision_count > 0 && entry_count == 0
                max_severity = 'none'
            end
    %>

        <li class="nav-item" id="sidebar-scans-id-<%= scan.id %>"

            <% if revision_count > 0 %>
                <% if entry_count > 0 %>
                    title="<%= pluralize entry_count, 'entry' %> with a maximum severity of <%= max_severity %>."
                <% else %>
                    title="<%= pluralize entry_count, 'entry' %>."
                <% end %>
            <% else %>
                title="Has not run yet."
            <% end %>
        >
            <%= link_to_with_filters scan, class: 'nav-link' do %>
                <%= scan.name %>

                <i class="fa fa-arrow-right">
                </i>

                <% if revision_count > 0 %>
                    <span class="label-severity badge-severity-<%= max_severity %>">
                        <%= entry_count %>
                    </span>
                <% end %>
            <% end %>
        </li>

        <li class="nav-item" class="sidebar-info" id="sidebar-scans-id-<%= scan.id %>-info">
            <small class="nav-link text-muted">
                <%= render partial: '/shared/scan_info', locals: {
                        scan: scan
                } %>

                <% if lr = scan.last_revision %>
                    <%= render partial: '/shared/revision_info', locals: {
                            revision:       lr,
                            hide_scan_name: true
                    } %>
                <% end %>
            </small>
        </li>
    <% end %>
</ul>
<% end %>
