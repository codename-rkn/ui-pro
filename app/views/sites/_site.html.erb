<tr data-site-id="<%= site.id %>">
    <td>
        <span class="site-favicon-container">
            <%= render partial: 'favicon', locals: { site: site } %>
        </span>

        <% if site.destroying? %>
        <%= site.url %>
        <% else %>
        <%= link_to site.url, site %>
        <% end %>
    </td>

    <td class="state">
        <% if site.scanned_or_being_scanned? %>
            <% if (max_severity = site.issues.max_severity) %>
                <span class="badge label-severity-<%= max_severity %>">
                    <%= issue_severity_to_site_status( max_severity ).capitalize %>
                </span>

                <% count = site.issues.send( "#{max_severity}_severity" ).size %>

                &mdash; <%= count %>
                <a href="<%= site_path site %>#issue-summary-severity-<%= max_severity %>"><%= max_severity %></a>
                severity <%= 'issue'.pluralize count %>
            <% else %>
                <span class="badge label-severity-none">Good</span>

                &mdash; no issues
            <% end %>
        <% else %>
            <span class="badge label-severity-undetermined">Undetermined</span>
        <% end %>
    </td>

    <td>
        <%= site.issues.size %>
    </td>

    <td>
        <%= site.scans.size %>
    </td>

    <td>
        <%= site.revisions.count %>
    </td>

    <td class="last-scanned">
        <% if !site.destroying? %>

        <% has_something = false %>

        <% if site.being_scanned? %>
            <% has_something = true %>
            <%= link_to [site, site.last_revision.scan, site.last_revision] do %>
                <i class="fas fa-spinner fa-spin"></i>
            <% end %>
        <% end %>

        <% if (last_performed = site.revisions.last_performed) %>
            <% has_something = true %>

            <%= link_to [site, last_performed.scan, last_performed] do %>
                <%= last_performed.performed_at %>
            <% end %>
        <% end %>

        <% if !has_something %>
            never
        <% end %>
        <% end %>
    </td>

    <td>
        <% if site.destroying? %>
        Deleting... <i class="fas fa-spinner fa-spin"></i>
        <% else %>
        <%= render partial: 'buttons', locals: { site: site } %>
        <% end %>
    </td>
</tr>
