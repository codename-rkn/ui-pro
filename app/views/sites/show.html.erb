<%
   title @site.url
   breadcrumb_add 'Sites', sites_path
%>

<div class="row" id="site-info">
    <div class="col-md-12">
        <%= render partial: 'shared/scan_heading' %>

        <% if (revision = @site.revision_in_progress) %>
            <p class="text-muted" id="site-info-scan-time">
                <i class="fa fa-spin fa-circle-o-notch"></i>
                Started on <%= l revision.started_at %> &mdash;
                <%= link_to revision.scan.name, [@site, revision.scan] %>
                (<%= link_to revision, [@site, revision.scan, revision] %>).
            </p>
        <% elsif (last_scanned_at = @site.last_scanned_at) %>
            <% last_revision = @site.last_revision %>
            <p class="text-muted" id="site-info-scan-time">
                Last scanned on <%= l last_scanned_at %> by
                <%= link_to last_revision.scan.name, [@site, last_revision.scan] %>
                (<%= link_to last_revision, [@site, last_revision.scan, last_revision] %>).
            </p>
        <% end %>

    </div>
</div>

<div id="site-tabs">
<% if @issues_summary %>
    <ul class="nav nav-tabs">
        <li class="<%= 'active' if @active_tab == 'overview' %>">
            <a href="#!/overview">
                Overview
            </a>
        </li>

        <li class="<%= 'active' if @active_tab == 'scans' %>">
            <a href="#!/scans">
                Scans
            </a>
        </li>

        <li class="<%= 'active' if @active_tab == 'roles' %>">
            <a href="#!/roles">
                Roles
            </a>
        </li>

        <li class="<%= 'active' if @active_tab == 'settings' %>">
            <a href="#!/settings">
                Settings
            </a>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane <%= 'active' if @active_tab == 'overview' %>" id="overview">
            <%= render partial: 'shared/scans_with_issue_summary' %>
        </div>

        <div class="tab-pane <%= 'active' if @active_tab == 'scans' %>" id="scans">
            <%= render partial: 'scans/tables' %>
        </div>

        <div data-js="<%= site_roles_path( @site ) %>"
            class="tab-pane <%= 'active' if @active_tab == 'roles' %>"
            id="roles">
            Roles.
        </div>

        <div class="tab-pane <%= 'active' if @active_tab == 'settings' %>" id="settings">
            <div class="row">
                <div class="col-md-2">
                    <%= render partial: 'sites/profile/sidebar' %>
                </div>
                <div class="col-md-10">
                    <%= render partial: 'sites/profile/form' %>
                </div>
            </div>
        </div>
    </div>
<% else %>
    <ul class="nav nav-tabs">
        <li class="<%= 'active' if @active_tab == 'scan-form' %>">
            <a href="#!/scan-form">
                New scan
            </a>
        </li>

        <li class="<%= 'active' if @active_tab == 'roles' %>">
            <a href="#!/roles">
                Roles
            </a>
        </li>

        <li class="<%= 'active' if @active_tab == 'settings' %>">
            <a href="#!/settings">
                Settings
            </a>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane <%= 'active' if @active_tab == 'scan-form' %>" id="scan-form">
            <div class="row">
                <div class="col-md-12">
                    <%= render 'scans/form' %>
                </div>
            </div>
        </div>

        <div data-js="<%= site_roles_path( @site ) %>"
             class="tab-pane <%= 'active' if @active_tab == 'roles' %>"
             id="roles">
            Roles.
        </div>

        <div class="tab-pane <%= 'active' if @active_tab == 'settings' %>" id="settings">
            <div class="row">
                <div class="col-md-2">
                    <%= render partial: 'sites/profile/sidebar' %>
                </div>
                <div class="col-md-10">
                    <%= render partial: 'sites/profile/form' %>
                </div>
            </div>
        </div>
    </div>

<% end %>
</div>
