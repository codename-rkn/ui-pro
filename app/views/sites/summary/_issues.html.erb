<%
    last_severity = nil
    last_name     = nil

    scoped_find_each( @site.issues ) do |issue|
    severity    = issue.severity
%>

<% if severity.name != last_severity %>

    <%
       last_name = nil
       if last_severity %>
            </ul>
            </div>
            </div>
            </div>
            </div>
        <hr/>
    <% end %>

    <div class="row" id="issue-summary-severity-<%= severity %>">
        <div class="col-md-12">

            <h3>
                <%= severity.capitalize %> severity
            </h3>
            <div class="cascade-container">
<% end %>

        <% if issue.type.name != last_name %>
            <% if last_name %>
                </ul>
                </div>
            <% end %>

            <div class="issue-summary-check-<%= issue.type.check_shortname %>">
                <h4>
                    <%= issue.type.name %>

                    <span class="badge-severity">
                        <%= @chart_data[:issue_names][issue.type.name] %>
                    </span>

                    <small>via:</small>
                </h4>
            <ul>
        <% end %>

            <li class="issue-summary-vector-<%= issue.vector.kind %>">
                <code><%= issue.vector.kind %></code>

                <% if issue.vector.affected_input_name %>
                    input <code><%= issue.vector.affected_input_name %></code>
                <% end %>

                at

                <%= link_to_url_with_external issue.vector.action, '#' %>
            </li>


<%
   last_name = issue.type.name
   last_severity = issue.severity.name
   end %>
</ul>
</div>
</div>
</div>
</div>
